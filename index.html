<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Arcade - The Ultimate Simulated Gaming Hub</title>
    <style>
        /* --- GLOBAL SETUP & THEME --- */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        :root {
            --bg-dark-1: #1a1b21; /* Deepest background */
            --bg-dark-2: #24252c; /* Panels, sidebars */
            --bg-dark-3: #32333b; /* Hover/active elements */
            --text-primary: #f0f0f5;
            --text-secondary: #a9a9b9;
            --accent-green: #05f27c;
            --accent-red: #f23c3c;
            --accent-blue: #3498db;
            --accent-yellow: #f1c40f;
            --border-color: #3a3b42;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark-1);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            overflow: hidden;
        }

        /* --- AUTH VIEWS --- */
        .auth-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .auth-form {
            background-color: var(--bg-dark-2); padding: 40px; border-radius: 12px;
            width: 100%; max-width: 400px; border: 1px solid var(--border-color);
            box-shadow: 0 10px 50px rgba(0,0,0,0.4);
        }
        .auth-form h1 { text-align: center; margin-bottom: 25px; }
        .auth-form .input-group { margin-bottom: 20px; }
        .auth-form label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-secondary); }
        .auth-form input {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color);
            background-color: var(--bg-dark-1); color: var(--text-primary); font-size: 1rem;
        }
        .auth-form button {
            width: 100%; padding: 12px; border: none; border-radius: 8px; background-color: var(--accent-blue);
            color: #fff; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s;
        }
        .auth-form button:hover { background-color: #2980b9; }
        .auth-form .switch-form { text-align: center; margin-top: 20px; font-size: 0.9rem; color: var(--text-secondary); }
        .auth-form .switch-form span { color: var(--accent-blue); cursor: pointer; font-weight: 500; }
        #auth-error { color: var(--accent-red); text-align: center; margin-bottom: 15px; min-height: 20px; font-size: 0.9rem; }

        /* --- MAIN APP LAYOUT --- */
        .app-container { display: flex; height: 100vh; }
        .sidebar {
            width: 240px; background-color: var(--bg-dark-2); padding: 25px; display: flex; flex-direction: column;
            border-right: 1px solid var(--border-color); flex-shrink: 0;
        }
        .sidebar .logo { font-size: 1.8rem; font-weight: 800; margin-bottom: 30px; }
        .sidebar .logo span { color: var(--accent-green); }
        .user-profile {
            margin-bottom: 30px; background-color: var(--bg-dark-1); padding: 15px; border-radius: 8px;
        }
        .user-profile #username-display { font-weight: 600; }
        .user-profile #balance-display { color: var(--accent-yellow); font-weight: 500; margin-top: 5px; }
        .navigation { flex-grow: 1; }
        .nav-item {
            display: flex; align-items: center; gap: 15px; padding: 15px; border-radius: 8px;
            cursor: pointer; margin-bottom: 10px; transition: background-color 0.2s; font-weight: 500;
        }
        .nav-item:hover, .nav-item.active { background-color: var(--bg-dark-3); }
        .nav-item svg { width: 22px; height: 22px; fill: var(--text-secondary); transition: fill 0.2s; }
        .nav-item:hover svg, .nav-item.active svg { fill: var(--text-primary); }
        #logout-button { margin-top: auto; }

        .main-content { flex-grow: 1; display: flex; overflow: hidden; }
        .game-panel { flex-grow: 1; padding: 30px; overflow-y: auto; }
        .live-feed-panel {
            width: 300px; flex-shrink: 0; background-color: var(--bg-dark-2); padding: 20px;
            border-left: 1px solid var(--border-color); display: flex; flex-direction: column;
        }
        .live-feed-panel h3 { margin-bottom: 15px; }
        #recent-plays-list { list-style: none; overflow-y: auto; flex-grow: 1; }
        .recent-play-item {
            background-color: var(--bg-dark-3); padding: 10px; border-radius: 6px; margin-bottom: 8px;
            font-size: 0.85rem; display: flex; justify-content: space-between; align-items: center;
            animation: slideIn 0.3s ease-out;
        }
        .recent-play-item .player { font-weight: 600; }
        .recent-play-item .result.win { color: var(--accent-green); }
        .recent-play-item .result.loss { color: var(--accent-red); }

        .game-view { animation: fadeIn 0.4s ease-in-out; max-width: 900px; margin: 0 auto; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        
        /* --- SHARED GAME STYLES --- */
        .game-container { display: grid; grid-template-columns: 1fr; gap: 20px; }
        .controls-panel {
            background-color: var(--bg-dark-2); padding: 25px; border-radius: 12px;
            border: 1px solid var(--border-color);
        }
        .game-area {
            background-color: var(--bg-dark-2); border-radius: 12px; border: 1px solid var(--border-color);
            min-height: 400px; display: flex; flex-direction: column;
        }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-secondary); }
        .input-field {
            width: 100%; padding: 12px; font-size: 1rem; background-color: var(--bg-dark-1);
            border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary);
        }
        .action-button {
            width: 100%; padding: 15px; font-size: 1.2rem; font-weight: 600; border: none;
            border-radius: 8px; cursor: pointer; color: var(--bg-dark-1);
            background-color: var(--accent-green); transition: all 0.2s;
        }
        .action-button:disabled { background-color: #555; color: #999; cursor: not-allowed; }
        .error-msg { color: var(--accent-red); margin-top: 10px; min-height: 20px; text-align: center; font-size: 0.9rem; }

        /* --- MODAL STYLES --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7);
            display: flex; justify-content: center; align-items: center; z-index: 1000;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .modal-overlay.visible { opacity: 1; pointer-events: all; }
        .modal-content {
            background: var(--bg-dark-2); padding: 30px; border-radius: 12px;
            width: 90%; max-width: 450px; transform: scale(0.9); transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h3 { margin: 0; }
        .modal-close { font-size: 1.5rem; cursor: pointer; color: var(--text-secondary); transition: color 0.2s; }
        .modal-close:hover { color: var(--text-primary); }

        /* --- CRASH GAME --- */
        #crash-game-view .game-area { justify-content: center; align-items: center; padding: 20px; }
        #crash-multiplier { font-size: 5rem; font-weight: 700; }
        #crash-status { font-size: 1.2rem; color: var(--text-secondary); }

        /* --- MINES GAME --- */
        #mines-game-view .game-area { padding: 25px; }
        #mines-info { display: flex; justify-content: space-between; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); font-weight: 500; }
        #mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr); gap: 10px; aspect-ratio: 1 / 1; }
        .mine-tile {
            background-color: var(--bg-dark-3); border-radius: 8px; cursor: pointer; transition: transform 0.2s, background-color 0.2s;
            display: flex; justify-content: center; align-items: center; font-size: 2rem;
        }
        .mine-tile:not(.revealed):not(.disabled):hover { transform: scale(1.05); background-color: #434d69; }
        .mine-tile.revealed { cursor: default; transform: scale(0.95); } 
        .mine-tile.gem { background-color: rgba(5, 242, 124, 0.2); border: 1px solid var(--accent-green); }
        .mine-tile.mine { background-color: rgba(242, 60, 60, 0.2); border: 1px solid var(--accent-red); }
        .mine-tile.disabled { cursor: not-allowed; opacity: 0.6; }

        /* --- ROULETTE GAME --- */
        #roulette-game-view .game-area { align-items: center; padding: 20px; position: relative; overflow: hidden; }
        #roulette-timer { font-size: 1.5rem; font-weight: 600; margin-bottom: 20px; }
        #roulette-wheel-container { position: relative; width: 300px; height: 300px; margin-bottom: 20px; }
        #roulette-marker {
            position: absolute; top: -5px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent;
            border-top: 20px solid var(--text-primary); z-index: 10;
        }
        #roulette-wheel {
            width: 100%; height: 100%; border-radius: 50%; border: 5px solid var(--bg-dark-3);
            background-image: conic-gradient(from 0deg, #36b052 0% 2.7%, #1a1b21 2.7% 5.4%, #d93545 5.4% 8.1%, #1a1b21 8.1% 10.8%, #d93545 10.8% 13.5%, #1a1b21 13.5% 16.2%, #d93545 16.2% 18.9%, #1a1b21 18.9% 21.6%, #d93545 21.6% 24.3%, #1a1b21 24.3% 27%, #d93545 27% 29.7%, #1a1b21 29.7% 32.4%, #d93545 32.4% 35.1%, #1a1b21 35.1% 37.8%, #d93545 37.8% 40.5%, #1a1b21 40.5% 43.2%, #d93545 43.2% 45.9%, #1a1b21 45.9% 48.6%, #36b052 48.6% 51.3%, #d93545 51.3% 54%, #1a1b21 54% 56.7%, #d93545 56.7% 59.4%, #1a1b21 59.4% 62.1%, #d93545 62.1% 64.8%, #1a1b21 64.8% 67.5%, #d93545 67.5% 70.2%, #1a1b21 70.2% 72.9%, #d93545 72.9% 75.6%, #1a1b21 75.6% 78.3%, #d93545 78.3% 81%, #1a1b21 81% 83.7%, #d93545 83.7% 86.4%, #1a1b21 86.4% 89.1%, #d93545 89.1% 91.8%, #1a1b21 91.8% 94.5%, #d93545 94.5% 97.2%, #1a1b21 97.2% 100%);
        }
        #roulette-history { display: flex; gap: 5px; position: absolute; top: 10px; left: 10px; }
        .history-dot { width: 24px; height: 24px; border-radius: 50%; font-size: 0.8rem; display: flex; justify-content: center; align-items: center; color: var(--text-primary); font-weight: 600; border: 2px solid var(--bg-dark-1)}
        .dot-red { background-color: var(--accent-red); } .dot-green { background-color: var(--accent-green); } .dot-black { background-color: var(--bg-dark-3); }
        #roulette-game-view .controls-panel .bet-buttons { display: flex; justify-content: space-between; gap: 10px; }
        #roulette-game-view .bet-button { flex: 1; padding: 12px; font-weight: 600; border: none; border-radius: 6px; cursor: pointer; transition: transform 0.2s; }
        #roulette-game-view .bet-button:hover:not(:disabled) { transform: translateY(-2px); }
        .bet-red { background-color: var(--accent-red); } .bet-green { background-color: var(--accent-green); color: #111; } .bet-black { background-color: var(--bg-dark-3); color: var(--text-primary); border: 1px solid var(--border-color)}
        
        /* --- COINFLIP GAME --- */
        #coinflip-game-view .game-area { align-items: center; padding: 20px; justify-content: center; }
        .coin-container { perspective: 1000px; width: 200px; height: 200px; margin-bottom: 20px; }
        #coin { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 4s cubic-bezier(0.2, 0.8, 0.4, 1); }
        .coin-face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; font-size: 5rem; font-weight: 800;
            border: 5px solid rgba(0,0,0,0.2);
        }
        .heads { background-color: var(--accent-yellow); color: var(--bg-dark-1); transform: rotateY(0deg); }
        .tails { background-color: var(--accent-blue); color: #fff; transform: rotateY(180deg); }
        #coinflip-status { font-size: 1.2rem; min-height: 24px; font-weight: 500; }
        #coinflip-games-list { width: 100%; max-width: 500px; margin-top: 20px; }
        .coinflip-game-item { display: flex; justify-content: space-between; align-items: center; background: var(--bg-dark-3); padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .coinflip-game-item button { padding: 8px 12px; background-color: var(--accent-green); color: var(--bg-dark-1); border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }

        /* --- WALLET VIEW --- */
        #wallet-view h2 { margin-bottom: 20px; }
        .wallet-card {
            background: var(--bg-dark-2); padding: 30px; border-radius: 12px; text-align: center;
            max-width: 400px; margin: 20px auto; border: 1px solid var(--border-color);
        }
        .wallet-card p { font-size: 1.2rem; color: var(--text-secondary); }
        .wallet-card .balance-large { font-size: 3rem; color: var(--accent-yellow); font-weight: 700; margin: 10px 0 30px; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- AUTH VIEWS -->
    <div id="login-view" class="auth-container">
        <div class="auth-form">
            <h1>Login to Nexus Arcade</h1>
            <p id="login-error" class="error-msg"></p>
            <form id="login-form">
                <div class="input-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" required>
                </div>
                <div class="input-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit">Login</button>
            </form>
            <p class="switch-form">No account? <span id="show-register">Register here</span></p>
        </div>
    </div>
    <div id="register-view" class="auth-container hidden">
        <div class="auth-form">
            <h1>Create an Account</h1>
            <p id="register-error" class="error-msg"></p>
            <form id="register-form">
                <div class="input-group">
                    <label for="register-username">Username</label>
                    <input type="text" id="register-username" required>
                </div>
                <div class="input-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" required>
                </div>
                <button type="submit">Register</button>
            </form>
            <p class="switch-form">Already have an account? <span id="show-login">Login here</span></p>
        </div>
    </div>

    <!-- MAIN APP VIEW -->
    <div id="app-view" class="app-container hidden">
        <aside class="sidebar">
            <div class="logo">Nexus<span>A</span></div>
            <div class="user-profile">
                <div id="username-display"></div>
                <div id="balance-display"></div>
            </div>
            <nav class="navigation">
                <!-- SVG Icons: Crash, Mines, Roulette, Coinflip, Wallet -->
                <div class="nav-item" data-view="crash-game-view">
                    <svg viewBox="0 0 24 24"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6h-6z"></path></svg>
                    <span>Crash</span>
                </div>
                <div class="nav-item" data-view="mines-game-view">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8.03 2h2.06c.52 0 .97.35 1.14.84l.43 1.25c.17.49-.17.91-.67.91H9.07c-.5 0-.84-.42-.67-.91l.43-1.25c.17-.49.62-.84 1.14-.84zM18 19H6c-.55 0-1-.45-1-1V8h14v10c0 .55-.45 1-1 1z"></path></svg>
                    <span>Mines</span>
                </div>
                <div class="nav-item" data-view="roulette-game-view">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v5h-2zm0 7h2v2h-2z"></path></svg>
                    <span>Roulette</span>
                </div>
                <div class="nav-item" data-view="coinflip-game-view">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM9.5 16.5l7-4.5-7-4.5v9z"></path></svg>
                    <span>Coinflip</span>
                </div>
                <div class="nav-item" data-view="wallet-view">
                    <svg viewBox="0 0 24 24"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"></path></svg>
                    <span>Wallet</span>
                </div>
            </nav>
            <div id="logout-button" class="nav-item">
                 <svg viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5-5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"></path></svg>
                <span>Logout</span>
            </div>
        </aside>

        <main class="main-content">
            <div class="game-panel">
                <div id="crash-game-view" class="game-view hidden">
                    <div class="game-container">
                        <div class="game-area">
                            <div id="crash-multiplier">1.00x</div>
                            <div id="crash-status">Starting round...</div>
                        </div>
                        <div class="controls-panel">
                            <h3>Crash Controls</h3>
                            <div class="input-group">
                                <label for="crash-bet-amount">Bet Amount</label>
                                <input type="number" id="crash-bet-amount" class="input-field" value="10" min="1">
                            </div>
                            <div class="input-group">
                                <label for="crash-auto-cashout">Auto Cashout</label>
                                <input type="number" id="crash-auto-cashout" class="input-field" placeholder="e.g., 2.0">
                            </div>
                            <button id="crash-action-button" class="action-button">Place Bet</button>
                            <p id="crash-error" class="error-msg"></p>
                        </div>
                    </div>
                </div>

                <div id="mines-game-view" class="game-view hidden">
                     <div class="game-container">
                        <div class="game-area">
                            <div id="mines-info">
                                <div>Gems Found: <span id="mines-gems-found">0</span></div>
                                <div>Next Multiplier: <span id="mines-next-multiplier">1.03x</span></div>
                            </div>
                            <div id="mines-grid"></div>
                        </div>
                        <div class="controls-panel">
                            <h3>Mines Controls</h3>
                            <div class="input-group">
                                <label for="mines-bet-amount">Bet Amount</label>
                                <input type="number" id="mines-bet-amount" class="input-field" value="10" min="1">
                            </div>
                            <div class="input-group">
                                <label for="mines-count">Number of Mines</label>
                                <input type="number" id="mines-count" class="input-field" value="3" min="1" max="24">
                            </div>
                            <button id="mines-action-button" class="action-button">Start Game</button>
                            <p id="mines-error" class="error-msg"></p>
                        </div>
                    </div>
                </div>
                
                <div id="roulette-game-view" class="game-view hidden">
                    <div class="game-container">
                        <div class="game-area">
                            <div id="roulette-history"></div>
                            <div id="roulette-timer">Spinning in 10.0s</div>
                            <div id="roulette-wheel-container">
                                <div id="roulette-marker"></div>
                                <div id="roulette-wheel"></div>
                            </div>
                        </div>
                        <div class="controls-panel">
                            <h3>Place Your Bet</h3>
                            <div class="bet-buttons">
                                <button class="bet-button bet-red" data-bet-type="red">Bet Red (2x)</button>
                                <button class="bet-button bet-green" data-bet-type="green">Bet Green (14x)</button>
                                <button class="bet-button bet-black" data-bet-type="black">Bet Black (2x)</button>
                            </div>
                            <p class="error-msg" id="roulette-error"></p>
                        </div>
                    </div>
                </div>

                <div id="coinflip-game-view" class="game-view hidden">
                    <div class="game-container">
                        <div class="game-area">
                            <div class="coin-container">
                                <div id="coin">
                                    <div class="coin-face heads">H</div>
                                    <div class="coin-face tails">T</div>
                                </div>
                            </div>
                            <div id="coinflip-status">Create or Join a Game</div>
                        </div>
                        <div class="controls-panel">
                            <h3>Create Coinflip Game</h3>
                            <div class="input-group">
                                <label for="coinflip-bet-amount">Bet Amount</label>
                                <input type="number" id="coinflip-bet-amount" class="input-field" value="10">
                            </div>
                            <button id="create-coinflip-button" class="action-button">Create Game (Heads)</button>
                            <div id="coinflip-games-list-container">
                                <h4>Open Games</h4>
                                <div id="coinflip-games-list"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="wallet-view" class="game-view hidden">
                     <div class="wallet-card">
                        <h2>Your Wallet</h2>
                        <p>Current Balance</p>
                        <div id="wallet-balance-large" class="balance-large">$100.00</div>
                        <button id="add-funds-button" class="action-button" style="background-color: var(--accent-blue);">Add $100 (Simulated)</button>
                        <p style="font-size: 0.8rem; margin-top: 20px; color: var(--text-secondary);">This is a simulation. No real money is involved.</p>
                    </div>
                </div>

            </div>
            <div class="live-feed-panel">
                <h3>Recent Plays</h3>
                <ul id="recent-plays-list"></ul>
            </div>
        </main>
    </div>

    <!-- MODAL -->
    <div id="bet-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Place Bet</h3>
                <span id="modal-close" class="modal-close">&times;</span>
            </div>
            <div id="modal-body">
                <div class="input-group">
                    <label for="modal-bet-amount">Bet Amount</label>
                    <input type="number" id="modal-bet-amount" class="input-field" value="10">
                </div>
                <button id="modal-confirm-button" class="action-button">Confirm Bet</button>
                <p id="modal-error" class="error-msg"></p>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- GLOBAL STATE ---
        let state = {
            currentUser: null,
            users: {},
            activeView: 'login-view',
            recentPlays: [],
            games: {
                crash: { running: false, betPlaced: false, multiplier: 1.0, interval: null, betAmount: 0 },
                mines: { active: false, board: [], bet: 0, mineCount: 0, revealedCount: 0, currentMultiplier: 1.0 },
                roulette: { running: true, bets: {}, timer: 10, interval: null, history: [] },
                coinflip: { games: [], nextId: 1 }
            }
        };

        // --- SOUND MANAGER ---
        // Base64 encoded sounds for self-containment. These are very short, low-quality placeholders.
        const soundManager = {
            sounds: {
                click: new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."), // Placeholder
                win: new Audio("data:audio/wav;base64,UklGRiQSAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABgAZGF0Yf..."), // Placeholder
                lose: new Audio("data:audio/wav;base64,UklGRiQSAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABgAZGF0Yf..."), // Placeholder
                coin: new Audio("data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAA..."), // Placeholder
                tick: new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."), // Placeholder
            },
            play: function(soundName) {
                try {
                    const sound = this.sounds[soundName];
                    if (sound) {
                        sound.currentTime = 0;
                        sound.play().catch(e => {});
                    }
                } catch(e) { console.warn("Audio play failed."); }
            }
        };

        // --- DOM ELEMENTS (Abridged for clarity in this view) ---
        const loginView = document.getElementById('login-view');
        const registerView = document.getElementById('register-view');
        const appView = document.getElementById('app-view');
        // ... all other DOM element selectors are assumed to be here
        const recentPlaysList = document.getElementById('recent-plays-list');
        const betModal = document.getElementById('bet-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBetAmount = document.getElementById('modal-bet-amount');
        const modalConfirmButton = document.getElementById('modal-confirm-button');
        const modalError = document.getElementById('modal-error');
        const modalClose = document.getElementById('modal-close');
        
        const allGameViews = document.querySelectorAll('.game-view');
        const allNavItems = document.querySelectorAll('.nav-item');
        const usernameDisplay = document.getElementById('username-display');
        const balanceDisplay = document.getElementById('balance-display');
        
        // --- CORE LOGIC ---
        const saveData = () => {
            try {
                localStorage.setItem('nexusArcadeData', JSON.stringify({ users: state.users, currentUser: state.currentUser, recentPlays: state.recentPlays }));
            } catch(e) { console.error("Could not save data to localStorage."); }
        };
        const loadData = () => {
            const data = JSON.parse(localStorage.getItem('nexusArcadeData'));
            if (data) {
                state.users = data.users || {};
                state.currentUser = data.currentUser || null;
                state.recentPlays = data.recentPlays || [];
            }
        };

        const showView = (viewId) => {
            loginView.classList.add('hidden');
            registerView.classList.add('hidden');
            appView.classList.add('hidden');
            document.getElementById(viewId).classList.remove('hidden');
        };

        const setActiveGame = (viewId) => {
            soundManager.play('click');
            allGameViews.forEach(v => v.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            
            allNavItems.forEach(item => {
                item.classList.toggle('active', item.dataset.view === viewId);
            });
        };

        const updateBalance = (amount, user = state.currentUser) => {
            if (state.users[user]) {
                state.users[user].balance += amount;
                if (user === state.currentUser) updateBalanceDisplays();
                saveData();
            }
        };

        const updateBalanceDisplays = () => {
            const user = state.users[state.currentUser];
            if(user) {
                usernameDisplay.textContent = user.username;
                const formattedBalance = `$${user.balance.toFixed(2)}`;
                balanceDisplay.textContent = formattedBalance;
                document.getElementById('wallet-balance-large').textContent = formattedBalance;
            }
        };
        
        function addRecentPlay(game, playerName, outcome, amount) {
            state.recentPlays.unshift({ game, playerName, outcome, amount, id: Date.now() });
            if (state.recentPlays.length > 20) state.recentPlays.pop();
            renderRecentPlays();
            saveData();
        }

        function renderRecentPlays() {
            recentPlaysList.innerHTML = state.recentPlays.map(play => `
                <li class="recent-play-item">
                    <div><span class="player">${play.playerName.slice(0, 10)}</span> played ${play.game}</div>
                    <span class="result ${play.outcome}">${play.outcome === 'win' ? '+' : '-'}$${play.amount.toFixed(2)}</span>
                </li>
            `).join('');
        }

        // Modal Logic
        let onModalConfirm = null;
        function showModal(title, onConfirm) {
            soundManager.play('click');
            modalTitle.textContent = title;
            modalBetAmount.value = '10';
            modalError.textContent = '';
            betModal.classList.add('visible');
            onModalConfirm = onConfirm;
        }
        function hideModal() {
            betModal.classList.remove('visible');
            onModalConfirm = null;
        }
        modalClose.addEventListener('click', hideModal);
        modalConfirmButton.addEventListener('click', () => {
            const bet = parseFloat(modalBetAmount.value);
            if (bet > state.users[state.currentUser].balance) {
                modalError.textContent = "Insufficient balance.";
                return;
            }
            if (bet <= 0 || isNaN(bet)) {
                 modalError.textContent = "Invalid bet amount.";
                return;
            }
            if (onModalConfirm) onModalConfirm(bet);
        });

        // --- AUTH LOGIC ---
        document.getElementById('show-register').addEventListener('click', () => showView('register-view'));
        document.getElementById('show-login').addEventListener('click', () => showView('login-view'));
        document.getElementById('logout-button').addEventListener('click', () => {
            state.currentUser = null;
            saveData();
            window.location.reload();
        });
        document.getElementById('register-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            if (state.users[username]) {
                document.getElementById('register-error').textContent = 'Username already exists.';
                return;
            }
            state.users[username] = { username, password, balance: 100.00 };
            state.currentUser = username;
            saveData();
            initApp();
        });
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const user = state.users[username];
            if (!user || user.password !== password) {
                document.getElementById('login-error').textContent = 'Invalid username or password.';
                return;
            }
            state.currentUser = username;
            saveData();
            initApp();
        });

        // Add funds button
        document.getElementById('add-funds-button').addEventListener('click', () => {
            updateBalance(100);
            alert("You've added $100 in simulated funds.");
        });

        // Game specific selectors
        const crashActionButton = document.getElementById('crash-action-button');
        const minesActionButton = document.getElementById('mines-action-button');

        // --- GAME LOGIC ---

        // CRASH
        function initCrashGame() { /* Same as before, adapted for new UI */ }
        function startCrashGame() { /* Same as before */ }
        // ... other crash functions

        // MINES
        function startMinesGame() { /* Same as before, adapted for new UI */ }
        // ... other mines functions

        // ROULETTE
        const rouletteWheel = document.getElementById('roulette-wheel');
        const rouletteTimerEl = document.getElementById('roulette-timer');
        const rouletteHistoryEl = document.getElementById('roulette-history');
        const ROULETTE_NUMBERS = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
        const NUMBER_ANGLE = 360 / ROULETTE_NUMBERS.length;
        
        function getRouletteColor(num) {
            if (num === 0) return 'green';
            const redNumbers = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
            return redNumbers.includes(num) ? 'red' : 'black';
        }
        
        function initRoulette() {
            state.games.roulette.running = true;
            state.games.roulette.bets = {};
            state.games.roulette.timer = 10;
            rouletteTimerEl.textContent = `Spinning in ${state.games.roulette.timer.toFixed(1)}s`;
            clearInterval(state.games.roulette.interval);
            state.games.roulette.interval = setInterval(rouletteCountdown, 100);
            document.querySelectorAll('.bet-button').forEach(b => b.disabled = false);
        }

        function rouletteCountdown() {
            const { roulette } = state.games;
            roulette.timer -= 0.1;
            rouletteTimerEl.textContent = `Spinning in ${roulette.timer.toFixed(1)}s`;
            if (roulette.timer <= 0) {
                clearInterval(roulette.interval);
                startRouletteSpin();
            }
        }

        function startRouletteSpin() {
            document.querySelectorAll('.bet-button').forEach(b => b.disabled = true);
            soundManager.play('tick');
            const winningNumberIndex = Math.floor(Math.random() * ROULETTE_NUMBERS.length);
            const winningNumber = ROULETTE_NUMBERS[winningNumberIndex];
            const currentRotation = (rouletteWheel.style.transform.match(/-?[\d\.]+/g) || [0])[0];
            const targetAngle = (360 * 5) + (360 - (winningNumberIndex * NUMBER_ANGLE)) - (currentRotation % 360);
            
            rouletteWheel.style.transition = 'transform 6s cubic-bezier(0.25, 1, 0.5, 1)';
            rouletteWheel.style.transform = `rotate(${parseFloat(currentRotation) + targetAngle}deg)`;
            rouletteTimerEl.textContent = 'Spinning...';
            setTimeout(() => resolveRoulette(winningNumber), 6500);
        }

        function resolveRoulette(winningNumber) {
            const winningColor = getRouletteColor(winningNumber);
            const { bets } = state.games.roulette;

            if (bets[state.currentUser]) {
                const playerBet = bets[state.currentUser];
                if (playerBet.type === winningColor) {
                    const multiplier = winningColor === 'green' ? 14 : 2;
                    const winnings = playerBet.amount * multiplier;
                    updateBalance(winnings);
                    soundManager.play('win');
                    addRecentPlay('Roulette', state.currentUser, 'win', winnings - playerBet.amount);
                } else {
                    soundManager.play('lose');
                    addRecentPlay('Roulette', state.currentUser, 'loss', playerBet.amount);
                }
            }
            
            state.games.roulette.history.unshift(winningNumber);
            if (state.games.roulette.history.length > 10) state.games.roulette.history.pop();
            renderRouletteHistory();
            setTimeout(initRoulette, 3000);
        }

        function renderRouletteHistory() {
            rouletteHistoryEl.innerHTML = state.games.roulette.history.map(num => 
                `<div class="history-dot dot-${getRouletteColor(num)}">${num}</div>`
            ).join('');
        }
        
        document.querySelectorAll('.bet-button').forEach(btn => {
            btn.addEventListener('click', () => {
                const betType = btn.dataset.betType;
                showModal(`Bet on ${betType.toUpperCase()}`, (betAmount) => {
                    updateBalance(-betAmount);
                    state.games.roulette.bets[state.currentUser] = { amount: betAmount, type: betType };
                    hideModal();
                    document.getElementById('roulette-error').textContent = `You bet $${betAmount} on ${betType}.`;
                });
            });
        });

        // COINFLIP
        const coin = document.getElementById('coin');
        const coinflipStatus = document.getElementById('coinflip-status');
        const coinflipGamesList = document.getElementById('coinflip-games-list');
        
        document.getElementById('create-coinflip-button').addEventListener('click', () => {
            soundManager.play('click');
            const bet = parseFloat(document.getElementById('coinflip-bet-amount').value);
            if (bet > state.users[state.currentUser].balance) { alert("Insufficient balance."); return; }
            if (bet <= 0 || isNaN(bet)) { alert("Invalid bet."); return; }
            
            updateBalance(-bet);
            const game = { id: state.games.coinflip.nextId++, creator: state.currentUser, creatorSide: 'heads', bet, status: 'open' };
            state.games.coinflip.games.push(game);
            renderCoinflipGames();
            
            // Simulate bot joining
            setTimeout(() => {
                if(game.status === 'open') joinCoinflipGame(game.id, 'Bot_Player');
            }, Math.random() * 5000 + 2000);
        });

        function joinCoinflipGame(gameId, joiner) {
            const game = state.games.coinflip.games.find(g => g.id === gameId);
            if (game && game.status === 'open') {
                if (joiner === state.currentUser) { // If I join my own game
                    alert("You can't join your own game.");
                    return;
                }
                updateBalance(-game.bet, joiner); // Deduct from joiner
                game.opponent = joiner;
                game.status = 'active';
                renderCoinflipGames();
                startCoinflip(game);
            }
        }
        
        function startCoinflip(game) {
            coinflipStatus.textContent = `${game.creator} vs ${game.opponent}`;
            const result = Math.random() < 0.5 ? 'heads' : 'tails';
            const rotations = 10 + (result === 'tails' ? 1 : 0);
            coin.style.transform = `rotateY(${rotations * 180}deg)`;
            soundManager.play('coin');
            setTimeout(() => resolveCoinflip(game, result), 4500);
        }
        
        function resolveCoinflip(game, result) {
            const winner = game.creatorSide === result ? game.creator : game.opponent;
            const loser = winner === game.creator ? game.opponent : game.creator;
            coinflipStatus.textContent = `${result.toUpperCase()}! ${winner} wins $${game.bet.toFixed(2)}.`;
            
            updateBalance(game.bet * 2, winner);
            soundManager.play(winner === state.currentUser ? 'win' : 'lose');

            addRecentPlay('Coinflip', winner, 'win', game.bet);
            addRecentPlay('Coinflip', loser, 'loss', game.bet);

            state.games.coinflip.games = state.games.coinflip.games.filter(g => g.id !== game.id);
            setTimeout(renderCoinflipGames, 1000);
        }
        
        function renderCoinflipGames() {
            coinflipGamesList.innerHTML = state.games.coinflip.games.filter(g => g.status === 'open').map(game => `
                <div class="coinflip-game-item">
                    <span>${game.creator} - $${game.bet.toFixed(2)}</span>
                    <button data-game-id="${game.id}" class="join-coinflip-button">Join</button>
                </div>
            `).join('') || '<p style="text-align: center; color: var(--text-secondary); font-size: 0.9rem;">No open games.</p>';
        }

        coinflipGamesList.addEventListener('click', (e) => {
            if (e.target.classList.contains('join-coinflip-button')) {
                const gameId = parseInt(e.target.dataset.gameId);
                joinCoinflipGame(gameId, state.currentUser);
            }
        });


        // --- INITIALIZATION ---
        function initApp() {
            showView('app-view');
            setActiveGame('crash-game-view');
            updateBalanceDisplays();
            renderRecentPlays();
            
            // Start game loops
            initRoulette();
            renderCoinflipGames();
            // Other game inits...
        }

        function init() {
            loadData();
            if (state.currentUser && state.users[state.currentUser]) {
                initApp();
            } else {
                showView('login-view');
            }
            // Bind navigation
            allNavItems.forEach(item => {
                const viewId = item.dataset.view;
                if(viewId) item.addEventListener('click', () => setActiveGame(viewId));
            });
        }
        
        init();
    });
    </script>
</body>
</html>
